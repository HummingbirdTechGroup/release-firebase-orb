description: >
  A command to build using `yarn <your build-instruction>` and then deploys to Firebase hosting with `firebase deploy <your firebase-instruction> --token=$FIREBASE_TOKEN`
# What will this job do?
# Descriptions should be short, simple, and clear.

parameters:
  firebase-instruction:
    type: string
    description: Used to augment the `firebase deploy` command. i.e `firebase
      deploy [your custom instruction] --token=$FIREBASE_TOKEN`.  Add
      the desitination and project here. The command expects an
      environment variable called FIREBASE_TOKEN to be in scope.
  build-instruction:
    type: string
    default: build
    description: The yarn instruction you want to use for the build stage. e.g
      `yarn [your command]`
  workflow-name:
    type: string
    default: Build & Deploy to Firebase
  notify-channel-fail:
    type: string
    default: $SLACK_DEFAULT_CHANNEL
  notify-channel-pass:
    type: string
    default: $SLACK_DEFAULT_CHANNEL

steps:
  - node/install-packages:
      pkg-manager: yarn
  - run:
      name: Building Project
      command: yarn <<parameters.build-instruction>>
  - run:
      name: Deploy to Firebase
      command: ./node_modules/.bin/firebase deploy
        <<parameters.firebase-instruction>> --token=$FIREBASE_TOKEN
  - slack/notify:
      channel: <<parameters.notify-channel-fail>>
      mentions: "@here"
      custom: |
        {
          "blocks": [
           {
        			"type": "section",
        			"text": {
        				"type": "mrkdwn",
        				"text": "ðŸ›‘ðŸ˜©ðŸ›‘ðŸ˜© *<<parameters.workflow-name>> Failed* ðŸ›‘ðŸ˜©ðŸ›‘ðŸ˜©"
        			}
        		}
          ]
        }
      event: fail
  - slack/notify:
      channel: <<parameters.notify-channel-pass>>
      custom: |
        {
          "blocks": [
           {
        			"type": "section",
        			"text": {
        				"type": "mrkdwn",
        				"text": "ðŸŽ‰ðŸŽ‰ *<<parameters.workflow-name>> Success* ðŸŽ‰ðŸŽ‰"
        			}
        		}
          ]
        }
      event: pass
